<!DOCTYPE html><html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>呐喊生成器</title> <link rel="icon" href="https://ws1.sinaimg.cn/large/40dfde6fgy1fqfje96ok7j20eo0d977t.jpg"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="https://cdn.bootcss.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet"> <link rel="stylesheet" type="text/css" media="screen" href="main.00be40b6.css"> <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script> <script src="https://cdn.bootcss.com/fabric.js/2.2.3/fabric.min.js"></script> <script src="https://cdn.bootcss.com/bootstrap/4.1.0/js/bootstrap.min.js"></script> <script src="https://cdn.bootcss.com/gif.js/0.2.0/gif.js"></script> <script src="https://cdn.bootcss.com/keypress/2.1.5/keypress.min.js"></script> <script src="https://cdn.bootcss.com/downloadjs/1.4.7/download.min.js"></script> <script src="https://cdn.bootcss.com/jquery.sticky/1.0.4/jquery.sticky.min.js"></script> </head> <body> <div class="container-fluid"> <div class="row"> <div class="col-md-7"> <canvas class="w-100" id="lazyPaper" width="640" height="1800"></canvas> </div> <div class="col-md-3"> <div class="top100" id="sidebar"> <h1 class="h2">呐喊生成器</h1> <form class="form-inline" onsubmit="return event.preventDefault(),!1" disabled> <button class="btn btn-primary mb-2 mr-sm-2" onclick="openit()">下载图片</button>  <button class="btn btn-outline-secondary mb-2 mr-sm-2" onclick="duplicateit()">复制图层</button> </form> <div> <textarea class="form-control mb-2 mr-sm-2" id="thetext" cols="30" rows="10" placeholder="点画布中的文字修改" onchange="update_text()" disabled></textarea> </div> <div class="intro"> ✨ 你也可以写生成器（零基础教程，122~134节，可免费看）：<a href="https://weibo.com/1088413295/GeKyfkg5C" target="_blank">https://weibo.com/1088413295/GeKyfkg5C</a><br><br> ✨ 图片来源：网上看的<br> ✨ 点击图中的文字可以进行修改<br> ✨ ctrl+v 可以粘贴本地图片和网络图片<br> ✨ delete 可以删除当前图层 </div> <ul id="image_list"> </ul> </div> </div> </div> </div> <script>var canvas=new fabric.Canvas("lazyPaper",{preserveObjectStacking:!0});canvas.backgroundColor="rgba(255,255,255,1)",fabric.Image.fromURL("talk.jpg",function(t){canvas.insertAt(t,0),reinit()});var text=new fabric.Text("GET /index.php HTTP/1.1",{left:170,top:265,fontFamily:"Courier",fontSize:26,fill:"#4ac358",fontWeight:"normal"});canvas.add(text);var text2=new fabric.Text("HTTP/1.1 403 forbidden",{left:170,top:635,fontFamily:"Courier",fontSize:26,fill:"#4ac358",fontWeight:"normal"});canvas.add(text2);var text3=new fabric.Text("GET /index.php HTTP/1.1",{left:170,top:985,fontFamily:"Courier",fontSize:26,fill:"#4ac358",fontWeight:"normal"});canvas.add(text3);var text4=new fabric.Text("HTTP/1.1 403 forbidden",{left:170,top:1355,fontFamily:"Courier",fontSize:26,fill:"#4ac358",fontWeight:"normal"});canvas.add(text4);var text5=new fabric.Text("sudo rm -rf /",{left:190,top:1715,fontFamily:"Courier",fontSize:26,fill:"#4ac358",fontWeight:"normal"});function reinit(){control_init(),eventit(),select_init()}function duplicateit(){var t=canvas.getActiveObject();if(t){console.log(t);var e=fabric.util.object.clone(t);console.log(e),e.set("top",e.top+20),e.set("left",e.left+20),canvas.add(e),canvas.setActiveObject(e),canvas.renderAll(),reinit()}else alert("请先选中图层再点我")}function eventit(){$(canvas.getObjects()).each((t,e)=>{e.on("mousedblclick",t=>{var e=t.target;console.log(e.type),canvas.bringToFront(e),canvas.discardActiveObject(),canvas.renderAll()})})}function openit(){download(canvas.toDataURL("image/jpeg",.6),"img.ftqq.com.jpg","image/jpeg")}function addit(){var t=$(" <img>",{src:canvas.toDataURL()}),e=$(" <li>");$(e).append(t),$("#image_list").append(e)}function downloadit(){gifit("download")}function buildit(){gifit("preview")}function gifit(t){if($("#image_list img").length<2)return alert("请先点击「加入序列」，加入至少两张图片"),!1;var e=new GIF({workerScript:"/fangtangGif/avatar/gif.worker.js",workers:2,quality:10,width:460,height:460});$("#image_list img").each((t,n)=>{e.addFrame(n,{delay:1e3})}),e.on("finished",function(e){blobToDataURL(e,e=>{"preview"==t?(alert("新窗口可能被浏览器屏蔽，如果看不到图，请允许网站弹出窗口"),window.open().document.write(" <img src='"+e+"'/>")):download(e,"img.ftqq.com.gif","img/gif")})}),e.render()}function update_text(){var t=$("#thetext").val();t.length>0&&(canvas.getActiveObject().set("text",t),canvas.renderAll(),$("#thetext").val(""),$("#thetext").prop("disabled",!0))}function blobToDataURL(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsDataURL(t)}function control_init(){var t=canvas.getObjects();$(t).each((t,e)=>{e.set({cornerSize:15,padding:5,transparentCorners:!0,cornerStyle:"circle",cornerColor:"red",borderColor:"red"})})}function clipboard_init(){console.log("IN"),document.addEventListener("paste",function(t){if(t.clipboardData){console.log("DATA");var e=null,n=t.clipboardData.items;if(n)for(var a=0;a<n.length;a++)if(console.log(n[a]),-1!==n[a].type.indexOf("image")&&(e=n[a].getAsFile()),null!==e){var i=new FileReader;i.onload=function(t){fabric.Image.fromURL(t.target.result,function(t){canvas.add(t),eventit(),control_init()})},i.readAsDataURL(e)}}})}function key_init(){canvas.listener=new window.keypress.Listener,canvas.listener.simple_combo("delete",function(){console.log("in delete"),canvas.remove(canvas.getActiveObject())}),canvas.listener.simple_combo("enter",function(t){t.preventDefault(),$("#thetext").blur()})}function select_init(){canvas.on("selection:updated",t=>edit_text(t)),canvas.on("selection:created",t=>edit_text(t))}function edit_text(t){var e=t.target;e&&(console.log(e.type),"text"==e.type?($("#thetext").val(e.text),$("#thetext").prop("disabled",!1)):($("#thetext").val(""),$("#thetext").prop("disabled",!0)))}canvas.add(text5),$(function(){$(".bg-list>li img").on("dblclick",function(){console.log("in bg"+this.src),fabric.Image.fromURL(this.src,function(t){canvas.add(t),eventit(),control_init()})}),$("#sidebar").sticky({topSpacing:0}),clipboard_init(),key_init()});</script> </body> </html>