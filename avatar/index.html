<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>动图小工厂·方糖气球🎈</title> <link rel="icon" href="https://ws1.sinaimg.cn/large/40dfde6fgy1fqfje96ok7j20eo0d977t.jpg"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="https://cdn.bootcss.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet"> <link rel="stylesheet" type="text/css" media="screen" href="main.fc66bd5f.css"> <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script> <script src="https://cdn.bootcss.com/fabric.js/2.2.3/fabric.min.js"></script> <script src="https://cdn.bootcss.com/bootstrap/4.1.0/js/bootstrap.min.js"></script> <script src="https://cdn.bootcss.com/gif.js/0.2.0/gif.js"></script> <script src="https://cdn.bootcss.com/keypress/2.1.5/keypress.min.js"></script> <script src="https://cdn.bootcss.com/downloadjs/1.4.7/download.min.js"></script> </head> <body> <div class="container-fluid"> <div class="row"> <nav class="col-md-2 d-none d-md-block bg-light"> <div class="sidebar-sticky"> <ul class="bg-list"> <li><img src="sina.14a75af6.png"></li> <li><img src="php.2a3f90d4.png"></li> <li><img src="github.d2028fab.png"></li>  </ul> <div class="intro"> ✨ 双击以上图片可以添加到画布上~<br> ✨ 双击画布图层可以使其向上层移动<br> ✨ 双击加入序列的图片可以删除<br> ✨ ctrl+v 可以粘贴本地图片和网络图片<br> ✨ delete 可以删除当前图层 </div> </div> </nav> <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4"> <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"> <h1 class="h2">外卖头像生成器·方糖动图小工厂</h1> </div> <canvas class="my-4 w-100" id="lazyPaper" width="460" height="460"></canvas> <div class="top100"> <form class="form-inline" onsubmit="return event.preventDefault(),!1" disabled> <button class="btn btn-primary mb-2 mr-sm-2" onclick="openit()">下载图片</button> <button class="btn btn-outline-secondary mb-2 mr-sm-2" onclick="addit()">加入序列</button> <button class="btn btn-outline-secondary mb-2 mr-sm-2" onclick="buildit()">预览GIF动图</button> <button class="btn btn-outline-secondary mb-2 mr-sm-2" onclick="downloadit()">下载GIF动图</button> <button class="btn btn-outline-secondary mb-2 mr-sm-2" onclick="duplicateit()">复制图层</button> <input class="form-control mb-2 mr-sm-2" id="thetext" placeholder="点画布中的文字修改" onchange="update_text()" disabled> </form> </div> <div> <ul id="image_list"> </ul> <img id="out"> </div> </main> </div> </div> <script>var canvas=new fabric.Canvas("lazyPaper",{preserveObjectStacking:!0});canvas.backgroundColor="rgba(255,255,255,1)",fabric.Image.fromURL("avatar.png",function(e){canvas.insertAt(e,0),reinit()});var text=new fabric.Text("这里爱写啥写啥",{left:120,top:130,fontFamily:"Microsoft YaHei",fontSize:32,fill:"white",fontWeight:"normal"});function reinit(){control_init(),eventit(),select_init()}function duplicateit(){var e=canvas.getActiveObject();if(e){console.log(e);var t=fabric.util.object.clone(e);console.log(t),t.set("top",t.top+20),t.set("left",t.left+20),canvas.add(t),canvas.setActiveObject(t),canvas.renderAll(),reinit()}else alert("请先选中图层再点我")}function eventit(){$(canvas.getObjects()).each((e,t)=>{t.on("mousedblclick",e=>{var t=e.target;console.log(t.type),canvas.bringToFront(t),canvas.discardActiveObject(),canvas.renderAll()})})}function openit(){download(canvas.toDataURL(),"img.ftqq.com.png","img/png")}function addit(){var e=$(" <img>",{src:canvas.toDataURL()}),t=$(" <li>");$(t).append(e),$("#image_list").append(t)}function downloadit(){gifit("download")}function buildit(){gifit("preview")}function gifit(e){if($("#image_list img").length<2)return alert("请先点击「加入序列」，加入至少两张图片"),!1;var t=new GIF({workerScript:"/gif.worker.js",workers:2,quality:10,width:460,height:460});$("#image_list img").each((e,n)=>{t.addFrame(n,{delay:1e3})}),t.on("finished",function(t){blobToDataURL(t,t=>{"preview"==e?(alert("新窗口可能被浏览器屏蔽，如果看不到图，请允许网站弹出窗口"),window.open().document.write(" <img src='"+t+"'/>")):download(t,"img.ftqq.com.gif","img/gif")})}),t.render()}function update_text(){var e=$("#thetext").val();if(e.length>0){var t=canvas.getActiveObject();console.log(t),t.set("text",e),canvas.discardActiveObject(),canvas.renderAll(),$("#thetext").val(""),$("#thetext").prop("disabled",!0)}}function blobToDataURL(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}function control_init(){var e=canvas.getObjects();$(e).each((e,t)=>{t.set({cornerSize:15,padding:5,transparentCorners:!0,cornerStyle:"circle",cornerColor:"red",borderColor:"red"})})}function clipboard_init(){console.log("IN"),document.addEventListener("paste",function(e){if(e.clipboardData){console.log("DATA");var t=null,n=e.clipboardData.items;if(n)for(var a=0;a<n.length;a++)if(console.log(n[a]),-1!==n[a].type.indexOf("image")&&(t=n[a].getAsFile()),null!==t){var i=new FileReader;i.onload=function(e){fabric.Image.fromURL(e.target.result,function(e){canvas.add(e),eventit()})},i.readAsDataURL(t)}}})}function key_init(){canvas.listener=new window.keypress.Listener,canvas.listener.simple_combo("delete",function(){console.log("in delete"),canvas.remove(canvas.getActiveObject())}),canvas.listener.simple_combo("enter",function(e){e.preventDefault(),$("#thetext").blur()})}function select_init(){canvas.on("selection:updated",e=>edit_text(e)),canvas.on("selection:created",e=>edit_text(e))}function edit_text(e){var t=e.target;t&&(console.log(t.type),"text"==t.type?($("#thetext").val(t.text),$("#thetext").prop("disabled",!1)):($("#thetext").val(""),$("#thetext").prop("disabled",!0)))}canvas.add(text),text.rotate(-20),fabric.Image.fromURL("github.png",function(e){canvas.add(e),e.rotate(-20),e.set("scaleX",.4),e.set("scaleY",.4),e.set("left",100),e.set("top",50),reinit()}),$(function(){$("#image_list").on("dblclick","li",function(){$(this).remove()}),$(".bg-list>li img").on("dblclick",function(){console.log("in bg"+this.src),fabric.Image.fromURL(this.src,function(e){canvas.add(e),eventit(),control_init()})}),clipboard_init(),key_init()});</script> </body> </html>